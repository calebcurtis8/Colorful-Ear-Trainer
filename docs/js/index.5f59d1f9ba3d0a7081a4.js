"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[826],{397:(t,e,i)=>{var s=i(1260);const n="EarTrainerUser";class a extends HTMLElement{constructor(){super(),this.addListeners(),this.storage=JSON.parse(localStorage.getItem(n))||{},this.inputs=this.querySelectorAll("input,select"),this.previous_notes=[],this.inputs.forEach((t=>{let e=t.getAttribute("name"),i=this.storage[e];i&&(t.value=i),t.dispatchEvent(new CustomEvent("change",{bubbles:!0})),this.set(e,t.value)}))}set(t,e){this.storage[t]=e,localStorage.setItem(n,JSON.stringify(this.storage))}get(t,e="normal"){let i=this.querySelector(`[name="${t}"]`).value;return this[e](i)}tempo(t){return 60/parseInt(t)}number(t){return parseInt(t)}float(t){return parseFloat(t)}array(t){return JSON.parse(t)}normal(t){return t}addListeners(){this.addEventListener("change",this.update.bind(this)),this.addEventListener("keyup",this.update.bind(this))}update(t){t.target.getAttribute("name")&&(this.set(t.target.getAttribute("name"),t.target.value),document.dispatchEvent(new CustomEvent("userupdate")))}}customElements.define("define-user",a);const o=document.getElementById("User"),r=document.getElementById("piano"),h=["C",["C#","Db"],"D",["D#","Eb"],"E","F",["F#","Gb"],"G",["G#","Ab"],"A",["A#","Bb"],"B"];function l(t,e){[...t.classList].forEach((i=>{i.startsWith(e)&&t.classList.remove(i)}))}r.fillKey=function(t,e){let i=this.getNote(t);i&&(i.style.fill=e)},r.getNote=function(t){return this.querySelector(`[data-note="${t}"]`)},r.clearKey=function(t){let e=this.getNote(t);e&&(e.style.fill=null)},new class{constructor(t){this.piano=t,this.notesDown=[],this.handlePlayClick=this.playClick.bind(this),this.handleListenClick=this.listenClick.bind(this),this.handleListenKeys=this.listenKeys.bind(this),this.handleListenShifts=this.listenShifts.bind(this),this.playback=!0,this.piano.addEventListener("click",this.handlePlayClick),this.piano.addEventListener("click",this.handleListenClick),document.addEventListener("keyup",this.handleListenKeys),document.addEventListener("keydown",this.handleListenShifts),document.addEventListener("keyup",this.handleListenShifts),document.addEventListener("question:start",this.clear.bind(this)),this.synth=(new s.WV).toDestination()}async play(t){if(!this.playback)return;await s.BL();let e=this.formatNote(t);this.synth.triggerAttackRelease(e,"8n")}playClick(t){let e=t.target.getAttribute("data-note").split(",")[0];this.play(e)}listenClick(t){this.listen(t.target.getAttribute("data-note"))}listenShifts(t){"ShiftLeft"!=t.code&&"ShiftRight"!=t.code||("keyup"==t.type&&("ShiftLeft"==t.code&&(this.shiftLeftActive=!1),"ShiftRight"==t.code&&(this.shiftRightActive=!1)),"keydown"==t.type&&("ShiftLeft"==t.code&&(this.shiftLeftActive=!0),"ShiftRight"==t.code&&(this.shiftRightActive=!0)))}listenKeys(t){let e=t.key.toUpperCase();if(-1==h.indexOf(e))return;let i=this.shiftRightActive,s=this.shiftLeftActive;if(i&&s)return;let n=`${e}${i?"#":""}${s?"b":""}`,a=h.filter((t=>Array.isArray(t)?t.indexOf(n)>-1:t===n)).map((t=>Array.isArray(t)?t.join(","):t));a=a.join(""),this.listen(a),this.play(a.split(",")[0])}listen(t){let e=t.split(","),i=!1,s=o.selected_notes||[];s.filter((t=>e.indexOf(t[0])>-1&&(i=t[0],!0)));let n=t;i?(this.piano.removeEventListener("click",this.handlePlay),r.fillKey(n,"rgba(80, 240, 80, 1)"),this.notesDown.push(n),this.piano.addEventListener("click",this.handlePlay)):s.length>0?(r.fillKey(n,"rgba(185, 28, 28, 1)"),this.notesDown.push(n)):(r.fillKey(n,"#fbbf24"),setTimeout((function(){r.clearKey(n)}),300));let a=i?this.formatNote(i):this.formatNote(e[0]);document.dispatchEvent(new CustomEvent("answer",{detail:a}))}clear(){this.notesDown.forEach((t=>{r.clearKey(t)}))}formatNote(t){return`${t}${o.get("octave","number")}`}}(r);const d=["green","pink","blue","purple","yellow"],c=["from","via","to"];class u extends HTMLElement{constructor(){super(),document.addEventListener("gameify:punish",this.reset.bind(this)),this.reset()}reset(){l(this,"from-"),l(this,"via-"),l(this,"to-");for(var t=[];t.length<3;){var e=Math.floor(Math.random()*d.length),i=d[e];-1===t.indexOf(i)&&t.push(i)}t=t.map(((t,e)=>`${c[e]}-${t}-500`)),this.classList.add(...t)}}customElements.define("fancy-background",u);const p=document.getElementById("KeyCenter");document.addEventListener("userupdate",(function(){document.dispatchEvent(new CustomEvent("transpose"))}));const m=["C",["C#","Db"],"D",["D#","Eb"],"E","F",["F#","Gb"],"G",["G#","Ab"],"A",["A#","Bb"],"B"],f=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],g=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],y={notes:[f,f,g,f,g,f,f,g,f,g,f,g],transpose(t,e=p.value){return t=Array.isArray(t)?t:[t],e=parseInt(e),t.map((t=>this.notes[e][this.normalizeIndex(parseInt(t)+e)]))},noteNames(t,e=p.value){return t=Array.isArray(t)?t:[t],e=parseInt(e),t.map((t=>m[this.normalizeIndex(parseInt(t))]))},normalizeIndex:t=>t>11?t-12:t};class v extends HTMLElement{constructor(){super(),this.set=this.querySelector("#NoteSet"),this.inactiveSet=this.querySelector("#InactiveSet"),this.setSelector=this.querySelectorAll(".note-sets option"),document.dispatchEvent(new CustomEvent("transpose")),document.addEventListener("transpose",this.transposeSetSelector.bind(this)),this.transposeSetSelector()}transposeSetSelector(){let t=o.get("tonality"),e=this.set.selectedIndex;this.setSelector.forEach(((e,i)=>{const s=/\{(.*?)}/gm;let n,a=e.getAttribute("data-template");for(;null!==(n=s.exec(a));)n.index===s.lastIndex&&s.lastIndex++,a=a.replaceAll(n[0],y.transpose([n[1]],p.value));e.innerText=a,-1==e.getAttribute("data-tonality").indexOf(t)?this.inactiveSet.appendChild(e):this.set.appendChild(e)})),this.set[e]&&(this.set.value=this.set[e].value)}}customElements.define("key-selector",v);class b extends HTMLElement{constructor(){super(),this.stopwatch=new class{constructor(){this.start=null,this.stop=null}startTimer(){if(this.stop)return this.start=this.stop,void(this.stop=null);this.start=Date.now()}stopTimer(){this.stop||(this.stop=Date.now())}reset(){this.start=null,this.stop=null}get getTimeElapsedInMs(){return null==this.start?0:null==this.stop?Date.now()-this.start:this.stop-this.start}get getSecondsElapsedIn60Seconds(){return Math.floor(this.getTimeElapsedInMs/1e3%60)}get getTimeElapsedInMinutes(){return Math.floor(this.getTimeElapsedInMs/1e3/60)}get getCurrentMillaSecondElapsedAsFraction(){return this.getTimeElapsedInMs%1e3/1e3}get getTimeElapsedInStopWatchFormatString(){let t=String(this.getTimeElapsedInMinutes),e=t.length>1?t:"0"+t,i=String(this.getSecondsElapsedIn60Seconds);return`${e}:${i.length>1?i:"0"+i}:${"0"+String(Math.floor(10*this.getCurrentMillaSecondElapsedAsFraction))}`}},this.display=this.querySelector("[data-time]"),this.face=this.querySelector("[data-face]"),this.limit=this.querySelector("[data-limit]"),this.timelimit=function(){return o.get("timelimit","float")*o.get("note_count","number")},this.timelimitInMs=function(){return 1e3*this.timelimit()*o.get("note_count","number")},document.addEventListener("gameify:afternotes",this.start.bind(this)),document.addEventListener("gameify:afteranswer",this.stop.bind(this)),document.addEventListener("gameify:pause",this.stop.bind(this)),document.addEventListener("userupdate",this.update.bind(this)),window.addEventListener("blur",this.stop.bind(this)),this.update()}start(){this.stop(),this.reset(),this.stopwatch.startTimer(),this.currentLimit=this.timelimitInMs(),this.refreshRate=setInterval(this.refresh.bind(this),10),this.face.classList.add("bg-success"),this.status="success"}stop(){this.isPaused=!0,this.stopwatch.stopTimer(),clearInterval(this.refreshRate)}reset(){this.stopwatch.reset(),l(this.face,"bg-")}refresh(){this.display.innerText=`${(this.stopwatch.getTimeElapsedInMs/1e3).toFixed(2)}s`,this.stopwatch.getTimeElapsedInMs>this.currentLimit&&"fail"!=this.status&&(l(this.face,"bg-"),this.face.classList.add("bg-fail"),this.status="fail",document.dispatchEvent(new CustomEvent("gameify:punish")))}update(){this.limit.innerText=`${this.timelimit()}s`}}customElements.define("stopwatch-timer",b),document.getElementById("Stopwatch"),Gameify;const E=new s.v2(s.WV).toDestination();async function S(t,e){await s.BL();const i=e?e+s.zO():s.zO();let n=0;t.forEach((t=>{let e=t.duration*o.get("bpm","tempo");t.sequence.forEach((t=>{E.triggerAttackRelease(t,e,i+n)})),n+=e}))}function w(t){return y.transpose(t).map((t=>`${t}${o.get("octave","number")}`))}const C=[[0,4,7],[0,5,9],[2,7,11],[0,4,7]],A=[[0,3,7],[0,5,8],[2,7,10],[0,3,7]];let L=function(){switch(o.get("tonality")){case"major":default:return C;case"minor":return A}},x=()=>[{sequence:w(L()[0]),duration:2},{sequence:w(L()[1]),duration:1},{sequence:w(L()[2]),duration:1},{sequence:w(L()[3]),duration:2}];function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function M(t,e,i){return e&&I(t.prototype,e),i&&I(t,i),t}function P(t){return+t.replace(/px/,"")}function T(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=Math.random()*(e-t)+t;return Math.floor(s*Math.pow(10,i))/Math.pow(10,i)}function j(t){return t[T(0,t.length)]}var B=["#fcf403","#62fc03","#f4fc03","#03e7fc","#03fca5","#a503fc","#fc03ad","#fc03c2"];function q(t){return Math.log(t)/Math.log(1920)}var D=function(){function t(e){k(this,t);var i=e.initialPosition,s=e.direction,n=e.confettiRadius,a=e.confettiColors,o=e.emojis,r=e.emojiSize,h=e.canvasWidth,l=T(.9,1.7,3)*q(h);this.confettiSpeed={x:l,y:l},this.finalConfettiSpeedX=T(.2,.6,3),this.rotationSpeed=o.length?.01:T(.03,.07,3)*q(h),this.dragForceCoefficient=T(5e-4,9e-4,6),this.radius={x:n,y:n},this.initialRadius=n,this.rotationAngle="left"===s?T(0,.2,3):T(-.2,0,3),this.emojiSize=r,this.emojiRotationAngle=T(0,2*Math.PI),this.radiusYUpdateDirection="down";var d="left"===s?T(82,15)*Math.PI/180:T(-15,-82)*Math.PI/180;this.absCos=Math.abs(Math.cos(d)),this.absSin=Math.abs(Math.sin(d));var c=T(-150,0),u={x:i.x+("left"===s?-c:c)*this.absCos,y:i.y-c*this.absSin};this.currentPosition=Object.assign({},u),this.initialPosition=Object.assign({},u),this.color=o.length?null:j(a),this.emoji=o.length?j(o):null,this.createdAt=(new Date).getTime(),this.direction=s}return M(t,[{key:"draw",value:function(t){var e=this.currentPosition,i=this.radius,s=this.color,n=this.emoji,a=this.rotationAngle,o=this.emojiRotationAngle,r=this.emojiSize,h=window.devicePixelRatio;s?(t.fillStyle=s,t.beginPath(),t.ellipse(e.x*h,e.y*h,i.x*h,i.y*h,a,0,2*Math.PI),t.fill()):n&&(t.font="".concat(r,"px serif"),t.save(),t.translate(h*e.x,h*e.y),t.rotate(o),t.textAlign="center",t.fillText(n,0,0),t.restore())}},{key:"updatePosition",value:function(t,e){var i=this.confettiSpeed,s=this.dragForceCoefficient,n=this.finalConfettiSpeedX,a=this.radiusYUpdateDirection,o=this.rotationSpeed,r=this.createdAt,h=this.direction,l=e-r;i.x>n&&(this.confettiSpeed.x-=s*t),this.currentPosition.x+=i.x*("left"===h?-this.absCos:this.absCos)*t,this.currentPosition.y=this.initialPosition.y-i.y*this.absSin*l+.00125*Math.pow(l,2)/2,this.rotationSpeed-=this.emoji?1e-4:1e-5*t,this.rotationSpeed<0&&(this.rotationSpeed=0),this.emoji?this.emojiRotationAngle+=this.rotationSpeed*t%(2*Math.PI):"down"===a?(this.radius.y-=t*o,this.radius.y<=0&&(this.radius.y=0,this.radiusYUpdateDirection="up")):(this.radius.y+=t*o,this.radius.y>=this.initialRadius&&(this.radius.y=this.initialRadius,this.radiusYUpdateDirection="down"))}},{key:"getIsVisibleOnCanvas",value:function(t){return this.currentPosition.y<t+100}}]),t}();function N(){var t=document.createElement("canvas");return t.style.position="fixed",t.style.width="100%",t.style.height="100%",t.style.top="0",t.style.left="0",t.style.zIndex="1000",t.style.pointerEvents="none",document.body.appendChild(t),t}function O(t){var e=t.confettiRadius,i=void 0===e?6:e,s=t.confettiNumber,n=void 0===s?t.confettiesNumber||(t.emojis?40:250):s,a=t.confettiColors,o=void 0===a?B:a,r=t.emojis,h=void 0===r?t.emojies||[]:r,l=t.emojiSize,d=void 0===l?80:l;return t.emojies&&console.error("emojies argument is deprecated, please use emojis instead"),t.confettiesNumber&&console.error("confettiesNumber argument is deprecated, please use confettiNumber instead"),{confettiRadius:i,confettiNumber:n,confettiColors:o,emojis:h,emojiSize:d}}const R=new(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};k(this,t),this.canvas=e.canvas||N(),this.canvasContext=this.canvas.getContext("2d"),this.shapes=[],this.lastUpdated=(new Date).getTime(),this.iterationIndex=0,this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}return M(t,[{key:"loop",value:function(){var t,e,i,s,n,a=this;t=this.canvas,e=window.devicePixelRatio,s=P((i=getComputedStyle(t)).getPropertyValue("width")),n=P(i.getPropertyValue("height")),t.setAttribute("width",(s*e).toString()),t.setAttribute("height",(n*e).toString());var o=(new Date).getTime(),r=o-this.lastUpdated,h=this.canvas.offsetHeight;this.shapes.forEach((function(t){t.updatePosition(r,o),t.draw(a.canvasContext)})),this.iterationIndex%100==0&&(this.shapes=this.shapes.filter((function(t){return t.getIsVisibleOnCanvas(h)}))),this.lastUpdated=o,this.iterationIndex++,requestAnimationFrame(this.loop)}},{key:"addConfetti",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=O(t),i=e.confettiRadius,s=e.confettiNumber,n=e.confettiColors,a=e.emojis,o=e.emojiSize,r=window.devicePixelRatio,h=this.canvas.width/r,l=this.canvas.height/r,d=5*l/7,c={x:0,y:d},u={x:h,y:d},p=0;p<s/2;p++)this.shapes.push(new D({initialPosition:c,direction:"right",confettiRadius:i,confettiColors:n,confettiNumber:s,emojis:a,emojiSize:o,canvasWidth:h})),this.shapes.push(new D({initialPosition:u,direction:"left",confettiRadius:i,confettiColors:n,confettiNumber:s,emojis:a,emojiSize:o,canvasWidth:h}))}}]),t}());class $ extends HTMLElement{constructor(){super(),this.streak=0,this.correct=0,this.total=0,this.late=0,this.fire=10,this.elements={streak:this.querySelector("[data-streak]"),correct:this.querySelector("[data-correct]"),total:this.querySelector("[data-total]"),late:this.querySelector("[data-late]"),gradient:this.querySelector("[data-gradient"),background:document.getElementById("background")},document.addEventListener("gameify:update",this.update.bind(this)),document.addEventListener("gameify:reward",this.reward.bind(this)),document.addEventListener("gameify:punish",this.punish.bind(this))}update(){this.elements.streak.innerText=this.streak,this.elements.correct.innerText=this.correct,this.elements.total.innerText=this.total,this.elements.gradient.style.width=this.correct/this.total*100+"%";let t=this.streak/this.fire;this.elements.background.style.opacity=t>=1?1:t,0==t?document.dispatchEvent(new CustomEvent("gameify:punish")):t>=1&&document.dispatchEvent(new CustomEvent("gameify:reward",{detail:{ratio:t,is_threshold:function(){return t>=1&&t==parseInt(t)}}}))}reward(t){let e=t.detail.ratio;t.detail.is_threshold()&&(1==e?R.addConfetti():R.addConfetti({emojis:["🔥","💥"]}))}punish(t){l(this.elements.background,"duration-"),this.elements.background.style.opacity=0,setTimeout((()=>{this.elements.background.classList.add("duration-1000")}),1e3)}}customElements.define("game-area",$);const F=document.getElementById("Gameify"),z=document.getElementById("Stopwatch");new class{constructor(){this.handleAnswer=this.registerAnswer.bind(this),this.playBtn=document.querySelector("#Play"),this.playBtn?.addEventListener("click",this.play.bind(this)),this.cadenceBtn=document.querySelector("#PlayCadence"),this.cadenceBtn?.addEventListener("click",this.playCadence.bind(this)),this.notesBtn=document.querySelector("#PlayNotes"),this.notesBtn?.addEventListener("click",function(){this.playNotes(0)}.bind(this))}play(){if(this.playBtn.isPlaying)return void this.pause();this.playCadence(),document.addEventListener("answer",this.handleAnswer),document.dispatchEvent(new CustomEvent("question:start"));let t=y.transpose(o.get("set","array"));o.notes=function(t=1,e=["C","D","E","F","G","A","B"]){let i=[];var s=o.previous_notes;s=s.map((t=>t[0]));let n=[];for(1===Math.floor(2*Math.random())&&t<3&&(n=s);i.length<t;){var a=Math.floor(Math.random()*e.length);-1===i.indexOf(e[a])&&n.indexOf(-1===e[a])&&i.push(e[a])}return i}(o.get("note_count","number"),t),o.selected_notes=this.setOctaves(JSON.parse(JSON.stringify(o.notes))),o.previous_notes=o.selected_notes,o.notes=this.setOctave(o.notes),this.setButtonState("PAUSE","bg-yellow-gradient",!0),this.playNotes(),setTimeout((()=>{this.playBtn.isPlaying&&document.dispatchEvent(new CustomEvent("gameify:afternotes"))}),1e3*this.offset)}playCadence(){this.playingCadence||(this.playingCadence=!0,this.offset=(S(x()),function(t){let e=0;return t.forEach((t=>e+=t.duration*o.get("bpm","tempo"))),e}(x())),setTimeout(function(){this.playingCadence=!1}.bind(this),1e3*this.offset))}playNotes(t=this.offset){o.selected_notes&&S([{sequence:o.selected_notes.map((t=>t.join(""))),duration:1}],t)}pause(){this.setButtonState("PLAY","bg-green-gradient",!1),document.dispatchEvent(new CustomEvent("gameify:pause"))}setButtonState(t,e,i){l(this.playBtn,"bg-"),this.playBtn.classList.add(e),this.playBtn.innerText=t,this.playBtn.isPlaying=i}setOctave(t){return t.map((t=>`${t}${o.get("octave","number")}`))}setOctaves(t){return t.map((t=>[t,`${o.get("octave","number")+Math.floor(Math.random()*o.get("spread","number"))}`]))}registerAnswer(t){if(-1==o.notes.indexOf(t.detail))return F.streak=0,F.total+=1,void this.dispatchUpdateEvent();"success"==z.status&&(F.streak+=1,F.correct+=1),"fail"==z.status&&(F.streak=0,F.late+=1),F.total+=1,this.dispatchUpdateEvent(),o.notes.splice(o.notes.indexOf(t.detail),1),0==o.notes.length&&(document.removeEventListener("answer",this.handleAnswer),document.dispatchEvent(new CustomEvent("gameify:afteranswer")),this.setButtonState("PLAY","bg-green-gradient",!1),setTimeout(this.play.bind(this),350))}dispatchUpdateEvent(){document.dispatchEvent(new CustomEvent("gameify:update"))}}}},t=>{t.O(0,[675,807],(()=>(397,t(t.s=397)))),t.O()}]);