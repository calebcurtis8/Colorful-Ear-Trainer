(self.webpackChunk=self.webpackChunk||[]).push([[826],{6226:(t,e,n)=>{var s,i;void 0===(i="function"==typeof(s=function(){const t=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"];class e extends HTMLElement{constructor(){super(),this.root=this.attachShadow({mode:"open"}),this.root.addEventListener("mousedown",(t=>{this.handleClick(t,!0),t.preventDefault()})),this.root.addEventListener("mouseup",(t=>{this.handleClick(t,!1),t.preventDefault()})),this.root.addEventListener("mouseout",(t=>{this.handleClick(t,!1),t.preventDefault()})),this.root.innerHTML=`<style>${this.getCss()}</style><div>${this.getNoteSvg()}`}static get observedAttributes(){return["key-count","keyboard-layout","read-only"]}get config(){return{keyCount:parseInt(this.getAttribute("key-count")||"88"),keyboardLayout:this.getAttribute("keyboard-layout")||"A",readOnly:this.hasAttribute("read-only")}}connectedCallback(){}attributeChangedCallback(){this.root.innerHTML=`<style>${this.getCss()}</style><div>${this.getNoteSvg()}</div>`}handleClick(t,e){if(this.config.readOnly)return;const n=t.target;if("rect"===n.tagName){const s=t.target.getAttribute("data-note"),i=parseInt(t.target.getAttribute("data-octave"));e?(this.setNoteDown(s,i),this.dispatchEvent(new CustomEvent("note-down",{detail:{note:s,octave:i}}))):n.hasAttribute("data-depressed")&&(this.setNoteUp(s,i),this.dispatchEvent(new CustomEvent("note-up",{detail:{note:s,octave:i}})))}}setNoteDown(t,e){const s=this.root.querySelector(n(t,e));s.classList.add("depressed"),s.setAttribute("data-depressed","data-depressed")}setNoteUp(t,e){const s=this.root.querySelector(n(t,e));s.classList.remove("depressed"),s.removeAttribute("data-depressed")}getNoteSvg(){const e=this.config.keyCount,n=function*(e){const n=t.indexOf(e),s=[...t.slice(n,t.length),...t.slice(0,n)];let i=0,o=!0;for(;;)for(let t=0;t<s.length;t++){const e=s[t];"C"!==e||o||(i+=1),yield{name:e,octave:i},o=!1}}(this.config.keyboardLayout),s=new Array(e).fill(1).map((()=>n.next().value));return`<svg viewBox="0 0 ${10*s.filter((t=>!t.name.includes("#"))).length+(s[s.length-1].name.includes("#")?3:0)+2} 52" version="1.1" xmlns="http://www.w3.org/2000/svg">\n            ${this.getKeysForNotes(s)}\n        </svg>`}getKeysForNotes(t){let e=-9;const n=t.map((t=>{let n=0;return t.name.includes("#")?n=e+7:(e+=10,n=e),{note:t.name,octave:t.octave,offset:n}}));return`<g>\n            ${n.filter((t=>!t.note.includes("#"))).map((t=>{return e=t.note,n=t.octave,s=t.offset,`<rect class="natural-note note" data-note="${e}" data-octave="${n}" x=${s} y=1></rect>`;var e,n,s}))}\n            ${n.filter((t=>t.note.includes("#"))).map((t=>{return e=t.note,n=t.octave,s=t.offset,`<rect class="sharp-note note" data-note="${e}" data-octave="${n}" x=${s} y=1></rect>`;var e,n,s}))}\n        </g>`}getCss(){return"\n        \n        :host {\n            --natural-key-color: #FFFFFF; \n            --natural-key-outline-color: #555555;\n            \n            --sharp-key-color: #555555;\n            --sharp-key-outline-color: #555555;\n            \n            --depressed-key-color: #808080;\n            --depressed-key-transform: scale(1, 0.95);\n        }\n        \n        :host {\n          display: block;\n        }\n        \n        .natural-note {\n          stroke: var(--natural-key-outline-color);\n          fill: var(--natural-key-color);\n          width: 10px;\n          height: 50px;\n        }\n        \n        .sharp-note {\n          stroke: var(--sharp-key-outline-color);\n          fill: var(--sharp-key-color);\n          width: 6px;\n          height: 30px;\n        }\n        \n        .depressed {\n          fill: var(--depressed-key-color);\n          transform: var(--depressed-key-transform);\n        }\n        "}}const n=(t,e)=>`[data-note="${t}"][data-octave="${e}"]`;customElements.define("piano-keys",e)})?s.call(e,n,e,t):s)||(t.exports=i)},5905:(t,e,n)=>{"use strict";const s=document.getElementById("KeyCenter");s.addEventListener("change",(function(){document.dispatchEvent(new CustomEvent("transpose"))}));const i=["C",["C#","Db"],"D",["D#","Eb"],"E","F",["F#","Gb"],"G",["G#","Ab"],"A",["A#","Bb"],"B"],o=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],a=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],r={notes:[o,o,a,o,a,o,o,a,o,a,o,a],transpose(t,e=s.value){return t=Array.isArray(t)?t:[t],e=parseInt(e),t.map((t=>this.notes[e][this.normalizeIndex(parseInt(t)+e)]))},noteNames(t,e=s.value){return t=Array.isArray(t)?t:[t],e=parseInt(e),t.map((t=>i[this.normalizeIndex(parseInt(t))]))},normalizeIndex:t=>t>11?t-12:t};class l extends HTMLElement{constructor(){super(),this.setSelector=this.querySelectorAll("#NoteSet option"),document.dispatchEvent(new CustomEvent("transpose")),document.addEventListener("transpose",this.transposeSetSelector.bind(this))}transposeSetSelector(){this.setSelector.forEach((t=>{const e=/\{(.*?)}/gm;let n,i=t.getAttribute("data-template");for(;null!==(n=e.exec(i));)n.index===e.lastIndex&&e.lastIndex++,i=i.replaceAll(n[0],r.transpose([n[1]],s.value));t.innerText=i}))}}customElements.define("key-selector",l),n(6226);var h=n(1260);function c(t){class e extends Error{constructor(){super("Invalid note name: "+t),this.name="NoteNameParseError",this.noteName=t}}function n(t){if("-"==t)throw new e;const n="C-D-EF-G-A-B".indexOf(t);if(-1==n)throw new e;return n}function s(t){const n="0123456789".indexOf(t);if(-1==n)throw new e;return 12*n}switch(t.length){case 2:return n(t[0])+s(t[1]);case 3:return n(t[0])+function(t){switch(t){case"b":return-1;case"#":return 1;default:throw new e}}(t[1])+s(t[2]);default:throw new e}}function d(t){return Math.floor(t/12)}function u(t){return t%12}const f=[0,2,4,5,7,9,11],p=[1,3,6,8,10];function m(t){return f.indexOf(u(t))>=0}function y(t){return p.indexOf(u(t))>=0}function g(t,e={}){const n=document.createElementNS("http://www.w3.org/2000/svg",t);for(const[t,s]of Object.entries(e))n.setAttribute(t,s);return n}const v=[1,18,25,42,49,73,90,97,114,121,138,145],b=class{constructor(t,e={}){let n=c(e.lowest||"A0");y(n)&&n--,n<0&&(n=0);let s=c(e.highest||"C8");if(y(s)&&s++,s<n)throw new RangeError("Highest note must not be lower than lowest note.");const i=e.keyStroke||"black",o=e.whiteKeyFill||"white";this._whiteKeyFill=o,this._whiteKeyHighlightFill=e.whiteKeyHighlightFill||"#00EA9C";const a=e.blackKeyFill||"black";this._blackKeyFill=a,this._blackKeyHighlightFill=e.blackKeyHighlightFill||"#00CC88";const r=[],l=[],h=[],f=168*d(n)+v[u(n)]-1;for(let t=n;t<=s;t++){const e=168*d(t)+v[u(t)]-f,n=m(t),s=g("rect",n?{x:e,y:1,width:24,height:140,rx:2,ry:2,stroke:i,"stroke-width":2,fill:o}:{x:e,y:1,width:14,height:90,rx:2,ry:2,stroke:i,"stroke-width":2,fill:a});r[t]=s,n?l.push(s):h.push(s)}this._keys=r;const p=g("svg",{viewBox:`0 0 ${2+24*l.length} 142`});for(const t of l)p.appendChild(t);for(const t of h)p.appendChild(t);t.appendChild(p)}fillKey(t,e){const n=c(t),s=this._keys[n];s&&s.setAttribute("fill",e||(m(n)?this._whiteKeyHighlightFill:this._blackKeyHighlightFill))}clearKey(t){const e=c(t),n=this._keys[e];n&&n.setAttribute("fill",m(e)?this._whiteKeyFill:this._blackKeyFill)}},w="EarTrainerUser";class E extends HTMLElement{constructor(){super(),this.addListeners(),this.storage=JSON.parse(localStorage.getItem(w))||{},this.inputs=this.querySelectorAll("input,select"),this.inputs.forEach((t=>{let e=t.getAttribute("name"),n=this.storage[e];n&&(t.value=n),t.dispatchEvent(new CustomEvent("change",{bubbles:!0})),this.set(e,t.value)}))}set(t,e){this.storage[t]=e,localStorage.setItem(w,JSON.stringify(this.storage))}get(t,e="normal"){return this.storage=JSON.parse(localStorage.getItem(w)),this[e](this.storage[t])}tempo(t){return 60/parseInt(t)}number(t){return parseInt(t)}array(t){return JSON.parse(t)}normal(t){return t}addListeners(){this.addEventListener("change",this.update.bind(this)),this.addEventListener("keyup",this.update.bind(this))}update(t){t.target.getAttribute("name")&&(this.set(t.target.getAttribute("name"),t.target.value),document.dispatchEvent(new CustomEvent("userupdate")))}}customElements.define("define-user",E);const k=document.getElementById("User"),C=document.getElementById("piano"),x=new b(C,{lowest:`C${k.get("octave","number")}`,highest:`B${k.get("octave","number")}`});function A(t,e){[...t.classList].forEach((n=>{n.startsWith(e)&&t.classList.remove(n)}))}new class{constructor(t){this.piano=t,this.notesDown=[],this.handlePlay=this.play.bind(this),this.handleListen=this.listen.bind(this),this.playback=!0,this.piano.addEventListener("click",this.handlePlay),this.piano.addEventListener("click",this.handleListen),document.addEventListener("question:start",this.clear.bind(this)),this.setKeyNames(),document.addEventListener("transpose",this.setKeyNames.bind(this))}setKeyNames(){x._keys.forEach(((t,e)=>{let n=e-12*k.get("octave","number");t.setAttribute("data-note",r.noteNames(n))}))}async play(t){if(!this.playback)return;await h.BL();let e=t.target.getAttribute("data-note").split(",")[0];const n=(new h.WV).toDestination();let s=this.formatNote(e);n.triggerAttackRelease(s,"8n")}listen(t){let e=t.target.getAttribute("data-note").split(","),n=!1,s=k.selected_notes||[];s.filter((t=>e.indexOf(t[0])>-1&&(n=t[0],!0)));let i=n?this.formatNote(n):this.formatNote(e[0]);n?(this.piano.removeEventListener("click",this.handlePlay),x.fillKey(i),this.notesDown.push(i),this.piano.addEventListener("click",this.handlePlay)):s.length>0?(x.fillKey(i,"rgba(185, 28, 28, 1)"),this.notesDown.push(i)):(x.fillKey(i,"#fbbf24"),setTimeout((function(){x.clearKey(i)}),300)),document.dispatchEvent(new CustomEvent("answer",{detail:i}))}clear(){this.notesDown.forEach((t=>{x.clearKey(t)}))}formatNote(t){return`${t}${k.get("octave","number")}`}}(C);const S=["green","pink","blue","purple","yellow"],L=["from","via","to"];class N extends HTMLElement{constructor(){super(),document.addEventListener("gameify:punish",this.reset.bind(this)),this.reset()}reset(){A(this,"from-"),A(this,"via-"),A(this,"to-");for(var t=[];t.length<3;){var e=Math.floor(Math.random()*S.length),n=S[e];-1===t.indexOf(n)&&t.push(n)}t=t.map(((t,e)=>`${L[e]}-${t}-500`)),this.classList.add(...t)}}function I(t,e){const n=new h.v2(h.WV).toDestination(),s=e?e+h.zO():h.zO();let i=0;t.forEach((t=>{let e=t.duration*k.get("bpm","tempo");t.sequence.forEach((t=>{n.triggerAttackRelease(t,e,s+i)})),i+=e}))}function P(t){return r.transpose(t).map((t=>`${t}${k.get("octave","number")}`))}customElements.define("fancy-background",N);let F=()=>[{sequence:P([0,4,7]),duration:2},{sequence:P([0,5,9]),duration:1},{sequence:P([2,7,11]),duration:1},{sequence:P([0,4,7]),duration:2}];function j(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function O(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function B(t,e,n){return e&&O(t.prototype,e),n&&O(t,n),t}function M(t){return+t.replace(/px/,"")}function D(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=Math.random()*(e-t)+t;return Math.floor(s*Math.pow(10,n))/Math.pow(10,n)}function $(t){return t[D(0,t.length)]}var K=["#fcf403","#62fc03","#f4fc03","#03e7fc","#03fca5","#a503fc","#fc03ad","#fc03c2"];function T(t){return Math.log(t)/Math.log(1920)}var q=function(){function t(e){j(this,t);var n=e.initialPosition,s=e.direction,i=e.confettiRadius,o=e.confettiColors,a=e.emojis,r=e.emojiSize,l=e.canvasWidth,h=D(.9,1.7,3)*T(l);this.confettiSpeed={x:h,y:h},this.finalConfettiSpeedX=D(.2,.6,3),this.rotationSpeed=a.length?.01:D(.03,.07,3)*T(l),this.dragForceCoefficient=D(5e-4,9e-4,6),this.radius={x:i,y:i},this.initialRadius=i,this.rotationAngle="left"===s?D(0,.2,3):D(-.2,0,3),this.emojiSize=r,this.emojiRotationAngle=D(0,2*Math.PI),this.radiusYUpdateDirection="down";var c="left"===s?D(82,15)*Math.PI/180:D(-15,-82)*Math.PI/180;this.absCos=Math.abs(Math.cos(c)),this.absSin=Math.abs(Math.sin(c));var d=D(-150,0),u={x:n.x+("left"===s?-d:d)*this.absCos,y:n.y-d*this.absSin};this.currentPosition=Object.assign({},u),this.initialPosition=Object.assign({},u),this.color=a.length?null:$(o),this.emoji=a.length?$(a):null,this.createdAt=(new Date).getTime(),this.direction=s}return B(t,[{key:"draw",value:function(t){var e=this.currentPosition,n=this.radius,s=this.color,i=this.emoji,o=this.rotationAngle,a=this.emojiRotationAngle,r=this.emojiSize,l=window.devicePixelRatio;s?(t.fillStyle=s,t.beginPath(),t.ellipse(e.x*l,e.y*l,n.x*l,n.y*l,o,0,2*Math.PI),t.fill()):i&&(t.font="".concat(r,"px serif"),t.save(),t.translate(l*e.x,l*e.y),t.rotate(a),t.textAlign="center",t.fillText(i,0,0),t.restore())}},{key:"updatePosition",value:function(t,e){var n=this.confettiSpeed,s=this.dragForceCoefficient,i=this.finalConfettiSpeedX,o=this.radiusYUpdateDirection,a=this.rotationSpeed,r=this.createdAt,l=this.direction,h=e-r;n.x>i&&(this.confettiSpeed.x-=s*t),this.currentPosition.x+=n.x*("left"===l?-this.absCos:this.absCos)*t,this.currentPosition.y=this.initialPosition.y-n.y*this.absSin*h+.00125*Math.pow(h,2)/2,this.rotationSpeed-=this.emoji?1e-4:1e-5*t,this.rotationSpeed<0&&(this.rotationSpeed=0),this.emoji?this.emojiRotationAngle+=this.rotationSpeed*t%(2*Math.PI):"down"===o?(this.radius.y-=t*a,this.radius.y<=0&&(this.radius.y=0,this.radiusYUpdateDirection="up")):(this.radius.y+=t*a,this.radius.y>=this.initialRadius&&(this.radius.y=this.initialRadius,this.radiusYUpdateDirection="down"))}},{key:"getIsVisibleOnCanvas",value:function(t){return this.currentPosition.y<t+100}}]),t}();function _(){var t=document.createElement("canvas");return t.style.position="fixed",t.style.width="100%",t.style.height="100%",t.style.top="0",t.style.left="0",t.style.zIndex="1000",t.style.pointerEvents="none",document.body.appendChild(t),t}function R(t){var e=t.confettiRadius,n=void 0===e?6:e,s=t.confettiNumber,i=void 0===s?t.confettiesNumber||(t.emojis?40:250):s,o=t.confettiColors,a=void 0===o?K:o,r=t.emojis,l=void 0===r?t.emojies||[]:r,h=t.emojiSize,c=void 0===h?80:h;return t.emojies&&console.error("emojies argument is deprecated, please use emojis instead"),t.confettiesNumber&&console.error("confettiesNumber argument is deprecated, please use confettiNumber instead"),{confettiRadius:n,confettiNumber:i,confettiColors:a,emojis:l,emojiSize:c}}const H=new(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};j(this,t),this.canvas=e.canvas||_(),this.canvasContext=this.canvas.getContext("2d"),this.shapes=[],this.lastUpdated=(new Date).getTime(),this.iterationIndex=0,this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}return B(t,[{key:"loop",value:function(){var t,e,n,s,i,o=this;t=this.canvas,e=window.devicePixelRatio,s=M((n=getComputedStyle(t)).getPropertyValue("width")),i=M(n.getPropertyValue("height")),t.setAttribute("width",(s*e).toString()),t.setAttribute("height",(i*e).toString());var a=(new Date).getTime(),r=a-this.lastUpdated,l=this.canvas.offsetHeight;this.shapes.forEach((function(t){t.updatePosition(r,a),t.draw(o.canvasContext)})),this.iterationIndex%100==0&&(this.shapes=this.shapes.filter((function(t){return t.getIsVisibleOnCanvas(l)}))),this.lastUpdated=a,this.iterationIndex++,requestAnimationFrame(this.loop)}},{key:"addConfetti",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=R(t),n=e.confettiRadius,s=e.confettiNumber,i=e.confettiColors,o=e.emojis,a=e.emojiSize,r=window.devicePixelRatio,l=this.canvas.width/r,h=this.canvas.height/r,c=5*h/7,d={x:0,y:c},u={x:l,y:c},f=0;f<s/2;f++)this.shapes.push(new q({initialPosition:d,direction:"right",confettiRadius:n,confettiColors:i,confettiNumber:s,emojis:o,emojiSize:a,canvasWidth:l})),this.shapes.push(new q({initialPosition:u,direction:"left",confettiRadius:n,confettiColors:i,confettiNumber:s,emojis:o,emojiSize:a,canvasWidth:l}))}}]),t}());class z extends HTMLElement{constructor(){super(),this.streak=0,this.correct=0,this.total=0,this.fire=10,this.elements={streak:this.querySelector("[data-streak]"),correct:this.querySelector("[data-correct]"),total:this.querySelector("[data-total]"),gradient:this.querySelector("[data-gradient"),background:document.getElementById("background")},document.addEventListener("gameify:update",this.update.bind(this)),document.addEventListener("gameify:reward",this.reward.bind(this)),document.addEventListener("gameify:punish",this.punish.bind(this))}update(){this.elements.streak.innerText=this.streak,this.elements.correct.innerText=this.correct,this.elements.total.innerText=this.total,this.elements.gradient.style.width=this.correct/this.total*100+"%";let t=this.streak/this.fire;this.elements.background.style.opacity=t>=1?1:t,0==t?document.dispatchEvent(new CustomEvent("gameify:punish")):t>=1&&document.dispatchEvent(new CustomEvent("gameify:reward",{detail:{ratio:t,is_threshold:function(){return t>=1&&t==parseInt(t)}}}))}reward(t){let e=t.detail.ratio;t.detail.is_threshold()&&(1==e?H.addConfetti():H.addConfetti({emojis:["🔥","💥"]}))}punish(t){A(this.elements.background,"duration-"),setTimeout((()=>{this.elements.background.classList.add("duration-1000")}),1e3)}}customElements.define("game-area",z);const U=document.getElementById("Gameify");new class{constructor(){this.handleAnswer=this.registerAnswer.bind(this),this.playBtn=document.querySelector("#Play"),this.playBtn?.addEventListener("click",this.play.bind(this)),this.cadenceBtn=document.querySelector("#PlayCadence"),this.cadenceBtn?.addEventListener("click",this.playCadence.bind(this)),this.notesBtn=document.querySelector("#PlayNotes"),this.notesBtn?.addEventListener("click",function(){this.playNotes(0)}.bind(this))}play(){this.playCadence(),document.addEventListener("answer",this.handleAnswer),document.dispatchEvent(new CustomEvent("question:start"));let t=r.transpose(k.get("set","array"));k.notes=function(t=1,e=["C","D","E","F","G","A","B"]){let n=[];for(;n.length<t;){var s=Math.floor(Math.random()*e.length);-1===n.indexOf(e[s])&&n.push(e[s])}return n}(k.get("note_count","number"),t),k.selected_notes=this.setOctaves(JSON.parse(JSON.stringify(k.notes))),k.notes=this.setOctave(k.notes),this.setButtonState("PLAYING",["from-yellow-400","to-yellow-300"]),this.playNotes()}playCadence(){this.offset=(I(F()),function(t){let e=0;return t.forEach((t=>e+=t.duration*k.get("bpm","tempo"))),e}(F()))}playNotes(t=this.offset){k.selected_notes&&I([{sequence:k.selected_notes.map((t=>t.join(""))),duration:1}],t),setTimeout((()=>{this.setButtonState("Play Your Answer(s)",["from-yellow-400","to-yellow-300"])}),1e3*t)}setButtonState(t,e){A(this.playBtn,"from-"),A(this.playBtn,"to-"),this.playBtn.classList.add(...e),this.playBtn.innerText=t}setOctave(t){return t.map((t=>`${t}${k.get("octave","number")}`))}setOctaves(t){return t.map((t=>[t,`${k.get("octave","number")+Math.floor(Math.random()*k.get("spread","number"))}`]))}registerAnswer(t){if(-1==k.notes.indexOf(t.detail))return U.streak=0,U.total+=1,void this.dispatchUpdateEvent();U.streak+=1,U.correct+=1,U.total+=1,this.dispatchUpdateEvent(),k.notes.splice(k.notes.indexOf(t.detail),1),0==k.notes.length&&(document.removeEventListener("answer",this.handleAnswer),setTimeout(this.play.bind(this),350))}dispatchUpdateEvent(){document.dispatchEvent(new CustomEvent("gameify:update"))}}}},t=>{t.O(0,[675,807],(()=>(5905,t(t.s=5905)))),t.O()}]);